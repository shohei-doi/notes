<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
<title>ノート: スクレイピング：Wikipedia編</title>

<meta property="description" itemprop="description" content="RでAPI経由でWikipediaのスクレイピングをする方法を説明します。"/>

<link rel="canonical" href="https://shohei-doi.github.io/notes/posts/2019-06-06-scraping-wikipedia/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2019-07-19"/>
<meta property="article:created" itemprop="dateCreated" content="2019-07-19"/>
<meta name="article:author" content="土井　翔平"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="ノート: スクレイピング：Wikipedia編"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="RでAPI経由でWikipediaのスクレイピングをする方法を説明します。"/>
<meta property="og:url" content="https://shohei-doi.github.io/notes/posts/2019-06-06-scraping-wikipedia/"/>
<meta property="og:image" content="https://shohei-doi.github.io/notes/posts/2019-06-06-scraping-wikipedia/scraping-wikipedia_files/figure-html5/unnamed-chunk-5-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="ノート"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="ノート: スクレイピング：Wikipedia編"/>
<meta property="twitter:description" content="RでAPI経由でWikipediaのスクレイピングをする方法を説明します。"/>
<meta property="twitter:url" content="https://shohei-doi.github.io/notes/posts/2019-06-06-scraping-wikipedia/"/>
<meta property="twitter:image" content="https://shohei-doi.github.io/notes/posts/2019-06-06-scraping-wikipedia/scraping-wikipedia_files/figure-html5/unnamed-chunk-5-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>
<meta property="twitter:creator" content="@sdoi0504"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","categories","twitter","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["スクレイピング：Wikipedia編"]},{"type":"character","attributes":{},"value":["RでAPI経由でWikipediaのスクレイピングをする方法を説明します。"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["土井　翔平"]},{"type":"character","attributes":{},"value":["国立情報学研究所"]}]}]},{"type":"character","attributes":{},"value":["2019-07-19"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[2]}]}]},{"type":"character","attributes":{},"value":["R","crawling/scraping"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creator"]}},"value":[{"type":"character","attributes":{},"value":["@sdoi0504"]}]},{"type":"character","attributes":{},"value":["https://shohei-doi.github.io/notes/posts/2019-06-06-scraping-wikipedia/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["scraping-wikipedia_files/bowser-1.9.3/bowser.min.js","scraping-wikipedia_files/distill-2.2.21/template.v2.js","scraping-wikipedia_files/figure-html5/unnamed-chunk-21-1.png","scraping-wikipedia_files/figure-html5/unnamed-chunk-21-2.png","scraping-wikipedia_files/figure-html5/unnamed-chunk-22-1.png","scraping-wikipedia_files/figure-html5/unnamed-chunk-22-2.png","scraping-wikipedia_files/figure-html5/unnamed-chunk-3-1.png","scraping-wikipedia_files/figure-html5/unnamed-chunk-5-1.png","scraping-wikipedia_files/figure-html5/unnamed-chunk-6-1.png","scraping-wikipedia_files/figure-html5/unnamed-chunk-7-1.png","scraping-wikipedia_files/figure-html5/unnamed-chunk-8-1.png","scraping-wikipedia_files/jquery-1.11.3/jquery.min.js","scraping-wikipedia_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #455a64;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative;}
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for table of contents */

.d-toc {
  color: rgba(0,0,0,0.8);
  font-size: 0.8em;
  line-height: 1em;
}

.d-toc-header {
  font-size: 0.6rem;
  font-weight: 400;
  color: rgba(0, 0, 0, 0.5);
  text-transform: uppercase;
  margin-top: 0;
  margin-bottom: 1.3em;
}

.d-toc a {
  border-bottom: none;
}

.d-toc ul {
  padding-left: 0;
}

.d-toc li>ul {
  padding-top: 0.8em;
  padding-left: 16px;
  margin-bottom: 0.6em;
}

.d-toc ul,
.d-toc li {
  list-style-type: none;
}

.d-toc li {
  margin-bottom: 0.9em;
}

.d-toc-separator {
  margin-top: 20px;
  margin-bottom: 2em;
}

.d-article-with-toc {
  border-top: none;
  padding-top: 0;
}



/* Tweak code blocks (note that this CSS is repeated above in an injection
   into the d-code shadow dom) */

d-code {
  overflow-x: auto !important;
}

pre.d-code code.d-code {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

pre.text-output {

  font-size: 12px;
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

@media(min-width: 768px) {

d-code {
  overflow-x: visible !important;
}

pre.d-code code.d-code  {
    padding-left: 18px;
    font-size: 14px;
}
pre.text-output {
  font-size: 14px;
}
}

/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}



/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}


/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // create d-bibliography
  var bibliography = $('<d-bibliography></d-bibliography>');
  $('#distill-bibliography').wrap(bibliography);

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace citations with <d-cite>
  $('.citation').each(function(i, val) {
    appendix = true;
    var cites = $(this).attr('data-cites').split(" ");
    var dt_cite = $('<d-cite></d-cite>');
    dt_cite.attr('key', cites.join());
    $(this).replaceWith(dt_cite);
  });
  // remove refs
  $('#refs').remove();

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-toc a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // replace code blocks with d-code
  $('pre>code').each(function(i, val) {
    var code = $(this);
    var pre = code.parent();
    var clz = "";
    var language = pre.attr('class');
    if (language) {
      // map unknown languages to "clike" (without this they just dissapear)
      if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                               "javascript", "js", "julia", "lua", "markdown",
                               "markup", "mathml", "python", "svg", "xml"]) == -1)
        language = "clike";
      language = ' language="' + language + '"';
      var dt_code = $('<d-code block' + language + clz + '></d-code>');
      dt_code.text(code.text());
      pre.replaceWith(dt_code);
    } else {
      code.addClass('text-output').unwrap().changeElementType('pre');
    }
  });

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('d-code, pre.text-output, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // table of contents
    if (have_authors) // adjust border if we are in authors
      $('.d-toc').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
    $('d-code').each(function(i, val) {
      var style = document.createElement('style');
      style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                        '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
      if (this.shadowRoot)
        this.shadowRoot.appendChild(style);
    });

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-toc-header').remove();
  $('.d-toc').remove();
  $('.d-toc-separator').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-75879658-3"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-75879658-3');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"スクレイピング：Wikipedia編","description":"RでAPI経由でWikipediaのスクレイピングをする方法を説明します。","authors":[{"author":"土井　翔平","authorURL":"#","affiliation":"国立情報学研究所","affiliationURL":"#"}],"publishedDate":"2019-07-19T00:00:00.000+09:00","citationText":"翔平, 2019"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">ノート</a>
</div>
<div class="nav-right">
<a href="../../../index.html">Shohei Doi</a>
<a href="../../index.xml">
<i class="fa fa-rss"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>スクレイピング：Wikipedia編</h1>
<p>RでAPI経由でWikipediaのスクレイピングをする方法を説明します。</p>
</div>

<div class="d-byline">
  土井　翔平  (国立情報学研究所)
  
<br/>2019-07-19
</div>

<div class="d-article">
<h3 class="d-toc-header">Table of Contents</h3>
<nav class="d-toc" id="TOC">
<ul>
<li><a href="#Intro">はじめに</a></li>
<li><a href="#Trend">Wikipediaのトレンド</a></li>
<li><a href="#PageInfo">Wikipediaの記事の情報</a></li>
<li><a href="#PageText">Wikipediaの記事</a></li>
<li><a href="#PageLink">Wikipediaの記事のリンク</a></li>
<li><a href="#Text">テキスト分析入門<code>*</code></a></li>
<li><a href="#Date">Wikipediaの記事の作成日の取得</a></li>
</ul>
</nav>
<hr class="d-toc-separator"/>
<h2 id="Intro">はじめに</h2>
<p><a href="https://shohei-doi.github.io/notes/posts/2019-04-18-scraping-twitter/">Twitterのスクレイピング</a>では10日以上前のツイートを取得できないことを知りました。 また、<a href="https://shohei-doi.github.io/notes/posts/2019-05-09-scraping-google/">Googleトレンド</a>は同時に5つまでしか取得できないのに、相対的な値しか取れません。 そこで、Wikipediaの閲覧数を取得する方法を説明します。</p>
<h3>必要なパッケージの読み込み</h3>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(tidyverse)</code></pre>
<pre><code>
── Attaching packages ─────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>
✔ ggplot2 3.2.0     ✔ purrr   0.3.2
✔ tibble  2.1.3     ✔ dplyr   0.8.3
✔ tidyr   0.8.3     ✔ stringr 1.4.0
✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>
── Conflicts ────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>
theme_set(theme_bw())</code></pre>
</div>
<p>Wikipediaの閲覧数は<a href="https://tools.wmflabs.org/pageviews/?project=en.wikipedia.org&amp;platform=all-access&amp;agent=user&amp;range=latest-20&amp;pages=Cat%7CDog">Pageview Analysis</a>のAPIをRから叩く<code>pageview</code>というパッケージを使います。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(pageviews)
library(gtrendsR)</code></pre>
</div>
<ul>
<li>Googleトレンドとの比較のために<code>gtrendsR</code>も読み込んでみます。</li>
</ul>
<p>また、Wikipediaの記事の情報を取得するには<code>WikipediR</code>というパッケージを使います。 <em>（2019年7月19日追記）</em>直接APIを叩いて情報を取得する際には<code>httr</code>というパッケージを使います。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(WikipediR)
library(httr)
library(rvest)</code></pre>
<pre><code>
Loading required package: xml2</code></pre>
<pre><code>
Attaching package: &#39;rvest&#39;</code></pre>
<pre><code>
The following object is masked from &#39;package:purrr&#39;:

    pluck</code></pre>
<pre><code>
The following object is masked from &#39;package:readr&#39;:

    guess_encoding</code></pre>
</div>
<h2 id="Trend">Wikipediaのトレンド</h2>
<p><code>pageviews</code>の<code>article_pageview()</code>という関数で閲覧数を取得します。 ただし、取得できるデータは2015年7月1日以降に限られます。</p>
<p>試しに、小泉純一郎と小泉進次郎の検索数を取得します。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
wiki_trend &lt;- article_pageviews(project = &quot;ja.wikipedia&quot;,
                                article = c(&quot;小泉純一郎&quot;, &quot;小泉進次郎&quot;),
                                start = &quot;2015070100&quot;,
                                end = Sys.Date())</code></pre>
</div>
<p>時系列のグラフにします。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
wiki_trend %&gt;% 
  ggplot() + 
  geom_line(aes(x = date, y = views, colour = article))</code></pre>
<p><img src="scraping-wikipedia_files/figure-html5/unnamed-chunk-5-1.png" width="624" /></p>
</div>
<p>Googleトレンドをも取得してみます。 スパイクはかなり一致しているように見えます。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
google_trend &lt;- gtrends(keyword = c(&quot;小泉純一郎&quot;, &quot;小泉進次郎&quot;), 
                        geo = &quot;JP&quot;, 
                        time = str_c(&quot;2015-07-01&quot;, Sys.Date(), sep = &quot; &quot;))
plot(google_trend)</code></pre>
<p><img src="scraping-wikipedia_files/figure-html5/unnamed-chunk-6-1.png" width="624" /></p>
</div>
<p>両者が相関しているのかどうかを確認します。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
full_join(wiki_trend %&gt;% 
            select(date, term = article, wiki = views),
          google_trend$interest_over_time %&gt;% 
            select(date, term = keyword, google = hits),
          by = c(&quot;date&quot;, &quot;term&quot;)) %&gt;% 
  ggplot() + 
  geom_point(aes(x = wiki, y = google, colour = term)) + 
  facet_wrap(~term)</code></pre>
<pre><code>
Warning: Removed 2536 rows containing missing values (geom_point).</code></pre>
<p><img src="scraping-wikipedia_files/figure-html5/unnamed-chunk-7-1.png" width="624" /></p>
</div>
<p>見にくいので両軸の対数を取ると正の相関がありそうなのが分かります。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
full_join(wiki_trend %&gt;% 
            select(date, term = article, wiki = views),
          google_trend$interest_over_time %&gt;% 
            select(date, term = keyword, google = hits),
          by = c(&quot;date&quot;, &quot;term&quot;)) %&gt;% 
  ggplot() + 
  geom_point(aes(x = wiki, y = google, colour = term)) + 
  scale_x_log10() + 
  scale_y_log10() + 
  facet_wrap(~term)</code></pre>
<pre><code>
Warning: Removed 2536 rows containing missing values (geom_point).</code></pre>
<p><img src="scraping-wikipedia_files/figure-html5/unnamed-chunk-8-1.png" width="624" /></p>
</div>
<h2 id="PageInfo">Wikipediaの記事の情報</h2>
<p><code>WikipediR</code>の<code>page_info()</code>で記事の情報を取得できます。 役に立ちそうな情報は記事の長さでしょうか。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
wiki_info &lt;- page_info(&quot;ja&quot;, &quot;wikipedia&quot;, page = &quot;小泉進次郎&quot;)
wiki_info$query$pages$`1875027`$length</code></pre>
<pre><code>
[1] 33307</code></pre>
</div>
<h2 id="PageText">Wikipediaの記事</h2>
<p><code>page_content()</code>で<code>.html</code>を取得できます。 <code>rvest</code>の<code>read_html()</code>で読み込みます。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
wiki_page &lt;- page_content(&quot;ja&quot;, &quot;wikipedia&quot;, page_name = &quot;小泉進次郎&quot;)
wiki_html &lt;- wiki_page$parse$text[[1]] %&gt;% 
  read_html()</code></pre>
</div>
<p>とりあえず<code>p</code>タグのテキストを抽出します。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
wiki_text &lt;- wiki_html %&gt;% 
  html_nodes(&quot;p&quot;) %&gt;% 
  html_text()
head(wiki_text)</code></pre>
<pre><code>
[1] &quot;小泉 進次郎（こいずみ しんじろう、1981年〈昭和56年〉4月14日 - ）は、日本の政治家。自由民主党所属の衆議院議員（4期）、自由民主党厚生労働部会長。\n&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
[2] &quot;内閣府大臣政務官兼復興大臣政務官、自民党青年局長、自民党農林部会長、自民党筆頭副幹事長などを歴任。\n&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
[3] &quot;父は第87代・第88代・第89代内閣総理大臣の小泉純一郎、兄は俳優・タレントの小泉孝太郎。\n&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
[4] &quot;小泉純一郎の次男として神奈川県横須賀市に生まれた。1982年に産まれて間もなく両親が離婚したため小泉家が引き取り、多忙な父に代わり、純一郎の実姉で同居する道子に育てられた。進次郎は伯母・道子を実の母と信じており「ママ」と呼んでいた。純一郎は道子と息子たちの関係（伯母と甥）を進次郎には伝えておらず、進次郎は中学二年生まで伯母とは知らされていなかった。孝太郎は伯母の存在を認識していたが、進次郎には伝えていなかった。中学生の進次郎は少なからずこの事実に驚いたが、2016年8月に道子が他界するまで実の母として大切にした。\n&quot;                                                                                                     
[5] &quot;1988年（昭和63年）に関東学院六浦小学校に入学して、大学卒業まで関東学院で過ごす。関東学院六浦中学校・高等学校ではスポーツ、特に野球に熱中した。2004年（平成16年）3月、23歳の時に関東学院大学経済学部経営学科を卒業。その後コロンビア大学大学院に留学し、ジェラルド・カーティスに師事して、2006年（平成18年）に政治学の修士号を取得した。その後、アメリカ合衆国にある、ロンドンタビストック人間関係研究所配下の戦略国際問題研究所非常勤研究員を経て2007年（平成19年）に帰国し、それ以後は父である純一郎の私設秘書を務める。\n&quot;                                                                                                         
[6] &quot;2008年（平成20年）に父・純一郎が政界引退を表明して、進次郎を後継候補に指名する。自由民主党の公認を受け、2009年（平成21年）の第45回衆議院議員総選挙に神奈川11区から出馬し、初当選。選挙戦では重複立候補を辞退し、また当時の連立与党である公明党からの選挙協力も受けなかった。地元の一部有権者からは世襲を批判されたものの父から受け継いだ強固な地盤と後援会をバックに終始優勢を維持し[2]、投票総数の過半数である150,893票（得票率57.1%）を獲得して初当選した[3]。この総選挙で初当選した5人の自民党の1期生のうち、政治や行政の経験がない唯一の新人議員である[4]。また小選挙区で当選した新人議員は小泉、橘慶一郎、伊東良孝の3人のみ。\n&quot;</code></pre>
</div>
<p>文字列ベクトルを一つの文章にするときは<code>str_c()</code>でオプション<code>collapse = &quot;&quot;</code>を指定します。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
wiki_text &lt;- wiki_text %&gt;% 
  str_c(collapse = &quot;&quot;)
wiki_text</code></pre>
<pre><code>
[1] &quot;小泉 進次郎（こいずみ しんじろう、1981年〈昭和56年〉4月14日 - ）は、日本の政治家。自由民主党所属の衆議院議員（4期）、自由民主党厚生労働部会長。\n内閣府大臣政務官兼復興大臣政務官、自民党青年局長、自民党農林部会長、自民党筆頭副幹事長などを歴任。\n父は第87代・第88代・第89代内閣総理大臣の小泉純一郎、兄は俳優・タレントの小泉孝太郎。\n小泉純一郎の次男として神奈川県横須賀市に生まれた。1982年に産まれて間もなく両親が離婚したため小泉家が引き取り、多忙な父に代わり、純一郎の実姉で同居する道子に育てられた。進次郎は伯母・道子を実の母と信じており「ママ」と呼んでいた。純一郎は道子と息子たちの関係（伯母と甥）を進次郎には伝えておらず、進次郎は中学二年生まで伯母とは知らされていなかった。孝太郎は伯母の存在を認識していたが、進次郎には伝えていなかった。中学生の進次郎は少なからずこの事実に驚いたが、2016年8月に道子が他界するまで実の母として大切にした。\n1988年（昭和63年）に関東学院六浦小学校に入学して、大学卒業まで関東学院で過ごす。関東学院六浦中学校・高等学校ではスポーツ、特に野球に熱中した。2004年（平成16年）3月、23歳の時に関東学院大学経済学部経営学科を卒業。その後コロンビア大学大学院に留学し、ジェラルド・カーティスに師事して、2006年（平成18年）に政治学の修士号を取得した。その後、アメリカ合衆国にある、ロンドンタビストック人間関係研究所配下の戦略国際問題研究所非常勤研究員を経て2007年（平成19年）に帰国し、それ以後は父である純一郎の私設秘書を務める。\n2008年（平成20年）に父・純一郎が政界引退を表明して、進次郎を後継候補に指名する。自由民主党の公認を受け、2009年（平成21年）の第45回衆議院議員総選挙に神奈川11区から出馬し、初当選。選挙戦では重複立候補を辞退し、また当時の連立与党である公明党からの選挙協力も受けなかった。地元の一部有権者からは世襲を批判されたものの父から受け継いだ強固な地盤と後援会をバックに終始優勢を維持し[2]、投票総数の過半数である150,893票（得票率57.1%）を獲得して初当選した[3]。この総選挙で初当選した5人の自民党の1期生のうち、政治や行政の経験がない唯一の新人議員である[4]。また小選挙区で当選した新人議員は小泉、橘慶一郎、伊東良孝の3人のみ。\n2009年12月13日、自民党が小泉による海上自衛隊横須賀基地（神奈川県横須賀市）見学ツアーを実施した際には、50人の定員に約5200人の応募が殺到するなど、「スター不在」とされる自民党内で際立った存在と見られている[5][6]。\n2010年1月の時点で衆議院では内閣委員会、総務委員会、安全保障委員会に所属し、自民党では遊説局長代理、青年局次長、外交副部会長、財務金融副部会長、環境副部会長などの役職を兼務して、外交、財務金融、環境の3つの部会に所属していた。同年10月には自民党学生部長、新聞出版局次長にも併せて就任した。\n2011年10月に自民党青年局長、国会対策委員会委員に就任した。\n2012年4月、郵政改正法案に造反[7]しても処分されなかった。同年6月26日の消費税増税法案には賛成票を投じた。同年8月9日、国民の生活が第一など野党6党が提出した野田内閣不信任決議案の採決では、棄権方針の自民党執行部に造反し、元幹事長の中川秀直などとともに賛成票を投じた。同年9月26日の自民党総裁選挙で青年局主催の候補者公開討論会を自民党青年局長として仕切る立場であり、当初は9月19日の公開討論会後に支持候補を表明すると明言していた[8]が、人気や知名度の高い小泉の支持表明は党員票や議員票として総裁選に影響を与えると目されるとして報道が過熱したことから、「衆議院1回生の私の1票が影響を与えるのは不本意。身の程をわきまえて行動する」と述べ、総裁選が終わるまで支持表明を行わない方針を示した[9][10]。総裁選終了後に石破茂に投票したことを発表した[11]。\n同年12月の第46回衆議院議員総選挙で再選し、党職では本人の希望もあって2期目の青年局長続投となった。この選挙で自民党が大勝した結果、青年局所属議員は82人となった[12]。\n2013年9月30日、青年局長を退任し内閣府大臣政務官（経済再生、経済財政、環太平洋経済連携協定（TPP）等担当[13]）兼復興大臣政務官に就任した。\n2014年12月の第47回衆議院議員総選挙で3選。\n2015年10月23日、自民党農林部会長に就任[14]。同年12月、政府が2015年度補正予算案に、低所得の年金受給者に一人あたり3万円を支給する臨時給付金を盛り込む方針について、「軽減税率対策として6000億足りない。一方で臨時給付金の4000億は簡単に出る。これが国民にどう思われるか。」と主張[15]、これらがきっかけとなり、2016年2月、若手議員の視点からの議論を期待して、自民党財政再建に関する特命委員会の下に、「2020年以降の経済財政構想小委員会」が設置され、小泉は事務局長に就任した[16]。\n同年8月、2020年以降の経済財政構想小委員会の委員長代行に昇格しつつ[17]、自民党農林部会長に留任。党部会長の人事では小泉のみ留任となった[18]。9月に第3次安倍第2次改造内閣下で設立された内閣府規制改革推進会議から、11月に「農薬などの資材を農家に売る事業からの撤退」や「農産品の委託販売の廃止」などの組織改革を早期に行うよう迫る厳しい提言があったが、党内で話合いの末に全農による自主的な組織刷新を行うという政府・自民党の農業改革案が了承されている[19]。「全農の体制こそ農家の経営の自由を奪う存在だ」と主張し、自民農林部会長として農業改革を主導している[20][21]。\n2017年8月より柴山昌彦とともに自民党筆頭副幹事長[22]。\n同年の第48回衆議院議員総選挙で4選。\n「交渉参加に賛成。交渉の中で勝ち取るべきは勝ち取る」との立場をとる[23]。\n関西学院大学での講演の中で、「日本人は国際競争というキーワードに過激な反応を示す、TPPで自由化されたら農業はやられると感情論に走る。TPPに参加しなければ農業は発展するのか?」と述べている。他の講演でも同様の発言を行っており、TPP参加について「後ろ向きに考えず、若い人はチャンスだと思ってほしい」「新しいルールができれば、既得権益にとらわれず新たなフィールドで活躍できる」「多少の痛みはあるかもしれないが、TPP1つで日本が壊れると思わない」と述べた。 \n反対が多い党内で、賛成派は少数だけに「血まみれになっている」という[24]。\n日本経済新聞社と米国戦略国際問題研究所CSISとで設立された日経・CSISバーチャル・シンクタンクに民主党に在籍していた前原誠司・長島昭久・近藤洋介・玄葉光一郎、みんなの党に在籍していた浅尾慶一郎、自民党の林芳正・西村康稔・齋藤健・岩屋毅等と共に、政治フォーラムとして在籍している。上級アドバイザーは石破茂が務めている。CSIS上級顧問兼日本支部長であるマイケル・グリーンはCSIS在籍時に秘書として従事した上司であり、直接指導を徹底的に施して小泉を親米派として作り上げることに成功した人物であると評論家の中田安彦は解説している[25]。\n2011年1月10日にまちおこしを目的とするグループ「TEAM YOKOSUKA」を立ち上げた。Tourism（観光）、Eco &amp; Environment（エコと環境）、America、Merchant &amp; Manufacture（商業と工業）の頭文字から成る[26]。\n2017年4月13日、13日、小泉は日本経済新聞のインタビューに応じ、将来の社会保障制度について「真の全世代型にする」と述べた。「自民党が高齢者偏重を助長してきた面もある」という指摘に対しては　「これは政治の責任がある。60歳以上は投票率が7割、20代は3割くらいの中でどちらの声が大きいか。全ての予算の裏にはそういった人たちがいる。ここと真剣に向き合っていかないといけない。こども保険はその覚悟の表れでもある」と主張。「消費税率を引き上げる選択肢はないのか」という疑問に対しては「8％から10％に上がるのは2年後だ。使い道は決まっている。新しいことをやるには10％以上の消費増税の話を決め、理解を得て執行されない限りできない。何年かかるのか。筋論として消費税はそうだと思うが、現実的な解としてはない」と答えた[27]。経済学者の田中秀臣は、小泉は財務省の消費増税路線やその背景にある財政再建主義に親和的であると評している[28]。\n自民党内で浮上した教育国債案については、「次世代への負担のつけ回し」と批判的な立場を取る[29]。代案として社会保険料に上乗せして徴収する「こども保険」を提唱した[29]。\n事務所費三重計上\n当選以来、父親である前任の支部長時代から、事務所費の不正経理が問いただされているが、一度として説明責任を果たしたことは無い。\n自宅敷地内にあるプレハブ小屋に、実弟が代表を務める政治団体が置かれているが、なぜか家賃等の事務所費が収支報告に計上されている。\nその後、別の政治団体が置かれている市内のテナントビルに転居するも、事実より高い家賃が計上され、しかもビル管理者は2団体分の家賃を受け取ったことはないと証言している。\n小泉純一郎は国会での答弁の際「政治活動は議員それぞれ」とだけ発言し、実態を明らかにしていない。\n+ 小泉進次郎オフィシャルサイト\n&quot;</code></pre>
</div>
<p><code>str_length()</code>で文字列の長さを調べることができます。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
str_length(wiki_text)</code></pre>
<pre><code>
[1] 4003</code></pre>
</div>
<ul>
<li>ページ情報の記事の長さとはだいぶ違います……</li>
</ul>
<h2 id="PageLink">Wikipediaの記事のリンク</h2>
<p>Wikipediaの記事のリンクを求めることもできます。 記事にある他のWikipedia記事へのリンク、外部サイトへのリンク、当該記事にリンクを貼っている他のWikipedia記事のリンクをそれぞれ求めることができます。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
internal_link &lt;- page_links(&quot;ja&quot;, &quot;wikipedia&quot;, page = &quot;小泉進次郎&quot;, limit = 500)
external_link &lt;- page_external_links(&quot;ja&quot;, &quot;wikipedia&quot;, page = &quot;小泉進次郎&quot;)
back_link &lt;- page_backlinks(&quot;ja&quot;, &quot;wikipedia&quot;, page = &quot;小泉進次郎&quot;)</code></pre>
</div>
<ul>
<li>内部リンクは最大500個までしか取れないようです。</li>
</ul>
<h2 id="Text">テキスト分析入門<code>*</code></h2>
<p>せっかくなので、初歩的なテキスト分析を行います。 まずは、小泉純一郎と小泉進次郎のWikipediaのページを取得します。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
term &lt;- c(&quot;小泉純一郎&quot;, &quot;小泉進次郎&quot;)
data &lt;- NULL
for (i in term) {
  text &lt;- page_content(&quot;ja&quot;, &quot;wikipedia&quot;, page_name = i)
  text &lt;- text$parse$text[[1]] %&gt;% 
    read_html() %&gt;% 
    html_nodes(&quot;p&quot;) %&gt;% 
    html_text() %&gt;% 
    str_c(collapse = &quot;&quot;)
  data &lt;- tibble(term = i,
                 text) %&gt;% 
    bind_rows(data)
}</code></pre>
</div>
<p>テキスト分析には<code>quanteda</code>というパッケージを使うのが便利です。</p>
<ul>
<li>日本語の<a href="https://quanteda.io/articles/pkgdown/quickstart_ja.html">クイックスタート</a>や開発者の一人である早稲田大学の渡辺さんの<a href="https://github.com/koheiw/workshop-IJTA">チュートリアル</a>が参考になります。</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(quanteda)</code></pre>
<pre><code>
Package version: 1.5.0</code></pre>
<pre><code>
Parallel computing: 2 of 8 threads used.</code></pre>
<pre><code>
See https://quanteda.io for tutorials and examples.</code></pre>
<pre><code>
Attaching package: &#39;quanteda&#39;</code></pre>
<pre><code>
The following object is masked from &#39;package:utils&#39;:

    View</code></pre>
</div>
<p>まずは、データフレームをコーパスに変換します。 コーパスとはテキストのデータという意味な気がします。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
corp &lt;- corpus(data, text_field = &quot;text&quot;)</code></pre>
</div>
<p>続いてトークンを作成します。 トークンとは単語というような意味で、日本語の場合は単語で区切られていないので形態素解析をする必要があります。</p>
<p>MecabやChasenが形態素解析ではメジャーですが、Rで実行するのは若干面倒なので、<a href="https://quanteda.io/articles/pkgdown/examples/japanese_speech_ja.html">quantedaのクイックスタート</a>で使用されているで例を使います。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
toks &lt;- tokens(corp)
toks &lt;- tokens_select(toks, &quot;^[０-９ぁ-んァ-ヶー一-龠]+$&quot;, valuetype = &quot;regex&quot;, padding = TRUE)

min_count &lt;- 10

kanji_col &lt;- tokens_select(toks, &quot;^[一-龠]+$&quot;, valuetype = &quot;regex&quot;, padding = TRUE) %&gt;% 
             textstat_collocations(min_count = min_count)
toks &lt;- tokens_compound(toks, kanji_col[kanji_col$z &gt; 3,], concatenator = &quot;&quot;)

kana_col &lt;- tokens_select(toks, &quot;^[ァ-ヶー]+$&quot;, valuetype = &quot;regex&quot;, padding = TRUE) %&gt;% 
            textstat_collocations(min_count = min_count)
toks &lt;- tokens_compound(toks, kana_col[kana_col$z &gt; 3,], concatenator = &quot;&quot;)

any_col &lt;- tokens_select(toks, &quot;^[０-９ァ-ヶー一-龠]+$&quot;, valuetype = &quot;regex&quot;, padding = TRUE) %&gt;% 
           textstat_collocations(min_count = min_count)
toks &lt;- tokens_compound(toks, any_col[any_col$z &gt; 3,], concatenator = &quot;&quot;)</code></pre>
</div>
<p>文章が単語に区切られたのが分かります。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
head(toks$text1)</code></pre>
<pre><code>
Warning: &#39;$.tokens&#39; is deprecated.
Use &#39;[].tokens&#39; instead.
See help(&quot;Deprecated&quot;)</code></pre>
<pre><code>
[1] &quot;小泉&quot;   &quot;進次郎&quot; &quot;&quot;       &quot;こ&quot;     &quot;いずみ&quot; &quot;しん&quot;  </code></pre>
<pre class="r"><code>
head(toks$text2)</code></pre>
<pre><code>
Warning: &#39;$.tokens&#39; is deprecated.
Use &#39;[].tokens&#39; instead.
See help(&quot;Deprecated&quot;)</code></pre>
<pre><code>
[1] &quot;小泉&quot;       &quot;純一郎&quot;     &quot;&quot;           &quot;こ&quot;         &quot;いずみ&quot;     &quot;じゅんいち&quot;</code></pre>
</div>
<p>最後に、トークンを文書行列にします。 文書行列とは各テキストを単語のベクトルにしたものです。</p>
<ul>
<li>ここで、1文字だけの単語や、頻度が高すぎる、低すぎる単語を削除します。</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
wiki_dfm &lt;- dfm(toks, remove = &quot;&quot;) %&gt;% 
    dfm_remove(&quot;^[ぁ-ん]+$&quot;, valuetype = &quot;regex&quot;, min_nchar = 2) %&gt;% 
    dfm_trim(min_termfreq = 0.50, termfreq_type = &quot;quantile&quot;, max_termfreq = 0.99)</code></pre>
</div>
<p>各記事の上位30の単語頻度を求めてみます。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
freq &lt;- textstat_frequency(wiki_dfm, group = &quot;term&quot;)
freq %&gt;% 
  filter(group == &quot;小泉純一郎&quot;) %&gt;% 
  filter(rank &lt;= 30) %&gt;% 
  mutate(feature = feature %&gt;% 
           fct_inorder() %&gt;% 
           fct_rev()) %&gt;% 
  ggplot(aes(x = feature, y = frequency)) + 
  geom_point() + 
  coord_flip()</code></pre>
<p><img src="scraping-wikipedia_files/figure-html5/unnamed-chunk-21-1.png" width="624" /></p>
<pre class="r"><code>
freq %&gt;% 
  filter(group == &quot;小泉進次郎&quot;) %&gt;% 
  filter(rank &lt;= 30) %&gt;% 
  mutate(feature = feature %&gt;% 
           fct_inorder() %&gt;% 
           fct_rev()) %&gt;% 
  ggplot(aes(x = feature, y = frequency)) + 
  geom_point() + 
  coord_flip()</code></pre>
<p><img src="scraping-wikipedia_files/figure-html5/unnamed-chunk-21-2.png" width="624" /></p>
</div>
<p>ワードクラウドを作成します。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
dfm_subset(wiki_dfm, term == &quot;小泉純一郎&quot;) %&gt;% 
  textplot_wordcloud(max_words = 50)</code></pre>
<p><img src="scraping-wikipedia_files/figure-html5/unnamed-chunk-22-1.png" width="624" /></p>
<pre class="r"><code>
dfm_subset(wiki_dfm, term == &quot;小泉進次郎&quot;) %&gt;% 
  textplot_wordcloud(max_words = 50)</code></pre>
<p><img src="scraping-wikipedia_files/figure-html5/unnamed-chunk-22-2.png" width="624" /></p>
</div>
<h2 id="Date">Wikipediaの記事の作成日の取得</h2>
<p><em>（2010年7月19日追記）</em>直接APIを叩いてWikipediaの記事の作成日を取得してみます。</p>
<p>まず、検索したい単語のベクトルを作成します。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
key.words &lt;- c(&quot;新世紀エヴァンゲリオン&quot;, &quot;魔法少女まどか☆マギカ&quot;, &quot;けものフレンズ&quot;)</code></pre>
</div>
<p>続いて、作成日を格納する空のベクトルを作成します。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
wiki.date &lt;- NULL</code></pre>
</div>
<p>最後に、ループによって各単語の記事の作成日を取得します。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
for (i in key.words) {
  wiki.date &lt;- c(wiki.date,
                 GET(&quot;https://ja.wikipedia.org/w/api.php&quot;,
                     query = list(action = &quot;query&quot;,
                                  prop = &quot;revisions&quot;,
                                  rvlimit = 1,
                                  rvprop = &quot;timestamp&quot;,
                                  rvdir = &quot;newer&quot;,
                                  titles = i,
                                  format = &quot;json&quot;)) %&gt;% 
                   content(&quot;text&quot;) %&gt;% 
                   str_extract(&quot;[0-9]+-[0-9]+-[0-9]+&quot;))
}</code></pre>
</div>
<p>念のため、データフレームにしておきます。</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
df &lt;- tibble(key.words,
             wiki.date)
df</code></pre>
<pre><code>
# A tibble: 3 x 2
  key.words              wiki.date 
  &lt;chr&gt;                  &lt;chr&gt;     
1 新世紀エヴァンゲリオン 2003-06-25
2 魔法少女まどか☆マギカ  2010-10-30
3 けものフレンズ         2016-04-16</code></pre>
</div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/2019-06-06-scraping-wikipedia/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=%E3%82%B9%E3%82%AF%E3%83%AC%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0%EF%BC%9AWikipedia%E7%B7%A8&amp;url=https%3A%2F%2Fshohei-doi.github.io%2Fnotes%2Fposts%2F2019-06-06-scraping-wikipedia%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fshohei-doi.github.io%2Fnotes%2Fposts%2F2019-06-06-scraping-wikipedia%2F">
        <i class="fab fa-facebook"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fshohei-doi.github.io%2Fnotes%2Fposts%2F2019-06-06-scraping-wikipedia%2F&amp;title=%E3%82%B9%E3%82%AF%E3%83%AC%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0%EF%BC%9AWikipedia%E7%B7%A8">
        <i class="fab fa-linkedin"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://notes-shohei-doi.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script>
var disqus_config = function () {
  this.page.url = 'https://shohei-doi.github.io/notes/posts/2019-06-06-scraping-wikipedia/';
  this.page.identifier = 'posts/2019-06-06-scraping-wikipedia/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://notes-shohei-doi.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
  <p>
    <div class="subscribe"><form method='post' action='https://blogtrottr.com'>
  <p>Enjoy this blog? Get notified of new posts via email:</p>
  <input type='text' name='btr_email' />
  <input type='hidden' name='btr_url'
         value='https://beta.rstudioconnect.com/content/3776/index.xml'/>
  <input type='hidden' name='schedule_type' value='0' />
  <input type='submit' value='Subscribe' />
</form>
</div>
  </p>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
